<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Gantt CERT Professional – גרסה 16</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#f5f7fb}
header{background:#0b1c2d;color:#fff;padding:16px}
main{padding:20px}
#log{background:#000;color:#0f0;padding:10px;font-size:12px;max-height:200px;overflow:auto}
button{padding:8px 12px;margin:4px}
</style>
</head>
<body>
<header>
  <h1>Gantt CERT Professional</h1>
  <div>Ghana Energy CERT – Amir Davidi Technologies | <b>גרסה 16</b></div>
</header>

<main>
  <button onclick="loadFromGitHub()">טען משימות מ‑GitHub</button>
  <div id="status">מוכן</div>
  <pre id="log"></pre>
</main>

<script>
'use strict';

function log(msg){
  const el=document.getElementById('log');
  el.textContent += msg + "\n";
  el.scrollTop = el.scrollHeight;
}

function base64ToUtf8(b64){
  const bin = atob(b64.replace(/\s/g,''));
  const bytes = new Uint8Array(bin.length);
  for(let i=0;i<bin.length;i++){bytes[i]=bin.charCodeAt(i);}
  return new TextDecoder('utf-8').decode(bytes);
}

async function loadFromGitHub(){
  try{
    document.getElementById('status').textContent='טוען…';
    log('שולח בקשה ל‑GitHub');
    const url='https://api.github.com/repos/Amird1976/GANA_PM/contents/tasks.csv?ref=main';
    const res=await fetch(url);
    if(!res.ok) throw new Error('HTTP '+res.status);
    const data=await res.json();
    const csv=base64ToUtf8(data.content);
    log('CSV נטען, אורך: '+csv.length);
    parseCSV(csv);
    document.getElementById('status').textContent='נטען בהצלחה';
  }catch(e){
    document.getElementById('status').textContent='שגיאה';
    log('שגיאה: '+e.message);
  }
}

function parseCSV(csv){
  const lines=csv.split(/\r?\n/).filter(l=>l.trim());
  if(lines.length<2){log('אין שורות');return;}
  const headers=lines[0].split(',').map(h=>h.trim());
  log('כותרות: '+headers.join(' | '));
  let count=0;
  for(let i=1;i<lines.length;i++){
    const cols=lines[i].split(',');
    if(cols[0] && cols[1]) count++;
  }
  log('משימות שזוהו: '+count);
}
</script>
</body>
</html>
