<!doctype html>
<html lang="he">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Gantt – Ghana Energy CERT (Drag & Drop)</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#f6f7fb;color:#111827}
  header{padding:16px 20px;background:#111827;color:#fff}
  header h1{margin:0;font-size:18px;font-weight:800;direction:rtl;text-align:right}
  header .meta{margin-top:6px;font-size:13px;opacity:.85;direction:rtl;text-align:right}
  .wrap{padding:16px 20px}
  .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
  .controls input,.controls select,.controls button{padding:10px 12px;border-radius:10px;border:1px solid #d1d5db;background:#fff;font-size:14px}
  .controls button{cursor:pointer}
  .controls .btn-primary{background:#111827;color:#fff;border-color:#111827}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 1px 2px rgba(0,0,0,.05)}
  .grid{display:grid;grid-template-columns: 540px 1fr;}
  .left{border-right:1px solid #e5e7eb}
  .right{overflow:auto}
  .row{display:flex;gap:10px;align-items:center;padding:8px 10px;border-bottom:1px solid #f1f5f9}
  .row:nth-child(odd){background:#fafafa}
  .row .title{flex:1;direction:rtl;text-align:right;font-size:13px;line-height:1.2}
  .row .meta{font-size:12px;color:#374151;white-space:nowrap}
  .timeline{position:relative;min-height: 40px;border-bottom:1px solid #e5e7eb;background:#fff}
  .ticks{display:flex;position:sticky;top:0;background:#fff;z-index:2}
  .tick{border-right:1px solid #eef2f7;padding:8px 6px;font-size:12px;color:#374151;white-space:nowrap}
  .bar-area{position:relative}
  .bar-row{position:relative;height:34px;border-bottom:1px solid #f1f5f9}
  .bar{position:absolute;top:7px;height:20px;border-radius:10px;background:#2563eb;cursor:grab;box-shadow:0 1px 1px rgba(0,0,0,.08)}
  .bar.dragging{cursor:grabbing;opacity:.9}
  .bar .label{position:absolute;left:10px;right:10px;top:2px;font-size:10px;line-height:1;color:#fff;opacity:.9;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;pointer-events:none}
  .bar .deps{position:absolute;left:10px;right:10px;bottom:2px;font-size:10px;line-height:1;color:#fff;opacity:.85;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;pointer-events:none}

  .handle{position:absolute;top:0;width:10px;height:20px;opacity:.0;}
  .bar:hover .handle{opacity:.35;}
  .handle.left{left:0;border-top-left-radius:10px;border-bottom-left-radius:10px;background:#0b3ea8;cursor:ew-resize}
  .handle.right{right:0;border-top-right-radius:10px;border-bottom-right-radius:10px;background:#0b3ea8;cursor:ew-resize}
  .hint{padding:10px 12px;font-size:12px;color:#374151;direction:rtl;text-align:right}
  .pill{display:inline-block;padding:3px 8px;border-radius:999px;background:#eef2ff;color:#1f2a6b;font-size:12px}

  #legend .lg-item{display:flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid #e5e7eb;border-radius:999px;background:#fff;font-size:12px}
  #legend .sw{width:12px;height:12px;border-radius:4px}
  .dep-layer{position:absolute;left:0;top:0;pointer-events:none;overflow:visible}


  .clickable{cursor:pointer}
  .group-header{background:#eef2ff;font-weight:700}


  .milestone{position:absolute;top:9px;width:16px;height:16px;background:#111827;transform:rotate(45deg);border-radius:3px;cursor:grab;box-shadow:0 1px 2px rgba(0,0,0,.12)}
  .milestone.dragging{cursor:grabbing;opacity:.9}
  .milestone .mlabel{position:absolute;left:18px;top:-2px;transform:rotate(-45deg);transform-origin:left top;font-size:10px;color:#111827;white-space:nowrap;max-width:260px;overflow:hidden;text-overflow:ellipsis;pointer-events:none}

</style>
</head>
<body>
<header>
  <div style="font-size:12px;letter-spacing:2px;opacity:.85;text-align:left">AMIR DAVIDI TECHNOLOGIES</div>
  <h1>גאנט פרויקט – Ghana Energy CERT (Drag & Drop)</h1>
  <div class="meta">
    גרירה של ה-Bar מזיזה משימה (Start/End). גרירת קצה ימני/שמאלי משנה Duration.
    <span class="pill">נשמר מקומית בדפדפן</span>
  </div>
</header>

<div id="sidePanel" style="
  position:fixed;top:0;right:-420px;width:420px;height:100%;
  background:#ffffff;border-left:1px solid #e5e7eb;
  box-shadow:-4px 0 12px rgba(0,0,0,.08);
  transition:right .25s ease;z-index:9999;display:flex;flex-direction:column">
  <div style="padding:14px 16px;border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between;align-items:center">
    <strong>פרטי משימה</strong>
    <button id="closePanel">✕</button>
  </div>
  <div id="panelBody" style="padding:14px 16px;overflow:auto;font-size:13px"></div>
</div>


<div class="wrap">
  <div class="controls">
    <input id="q" placeholder="חיפוש (Task / Owner / Phase / ID)..." style="min-width:320px"/>
    <select id="ownerFilter"><option value="">כל ה-Owners</option></select>
    <select id="zoom">
      <option value="day">יום (Day)</option>
      <option value="week" selected>שבוע (Week)</option>
      <option value="month">חודש (Month)</option>
    </select>
    <div id="legend" style="display:flex;gap:8px;flex-wrap:wrap;align-items:center"></div>
    <button class="btn-primary" id="expandAll">Expand All</button>
    <button class="btn-primary" id="autoSchedule">Auto-Schedule</button>
    <button class="btn-primary" id="exportCsv">Export CSV</button>
    <button id="reset">איפוס</button>
  </div>

  <div class="card">
    <div class="grid">
      <div class="left" id="left"></div>
      <div class="right">
        <div class="timeline" id="timeline"></div>
        <div class="bar-area" id="bars"></div>
      </div>
    </div>
    <div class="hint">
      טיפ: כדי דיוק גבוה, העבר ל-Zoom "יום". דאבל-קליק על בר מציג פרטים. אחרי עריכה אפשר Export CSV ולהדביק חזרה לאקסל.
    </div>
  </div>
</div>

<script>
const MS_DAY = 86400000;

// ===== Phase group registry for Expand All =====
const PHASE_GROUPS = [];

const MIN_START = new Date("2026-01-05");
const MAX_END = new Date("2026-06-10");

const BASE = [{"id": "1", "phase": "1. Management", "name": "פתיחת פרויקט וניהול (Phase 1)", "owner": "צוות יעוץ", "start": "2026-01-05", "end": "2026-02-04", "startOffset": 0, "duration": 30, "deps": ""}, {"id": "2", "phase": "1.1 Admin", "name": "פגישת קיק-אוף והתנעת צוות היגוי", "owner": "צוות יעוץ", "start": "2026-01-05", "end": "2026-01-07", "startOffset": 0, "duration": 2, "deps": ""}, {"id": "3", "phase": "1.1 Admin", "name": "הקמת משרד PMO פיזי באקרה (Ghana)", "owner": "Local Ops", "start": "2026-01-07", "end": "2026-01-21", "startOffset": 2, "duration": 14, "deps": "2"}, {"id": "4", "phase": "1.1 Admin", "name": "הכנת תוכנית ניהול פרויקט (PMP) מעודכנת", "owner": "צוות יעוץ", "start": "2026-01-07", "end": "2026-01-17", "startOffset": 2, "duration": 10, "deps": "2"}, {"id": "5", "phase": "1.2 Regs", "name": "איסוף מסמכי EUC מ-17 גופים (חתימות סופיות)", "owner": "Indigo", "start": "2026-01-17", "end": "2026-02-06", "startOffset": 12, "duration": 20, "deps": "4"}, {"id": "6", "phase": "1.2 Regs", "name": "הגשת בקשה לרישיון שיווק וייצוא (אפכ\"א)", "owner": "Adi (Elta)", "start": "2026-02-06", "end": "2026-02-20", "startOffset": 32, "duration": 14, "deps": "5"}, {"id": "7", "phase": "1.2 Regs", "name": "קבלת אישור משרד הביטחון להצפנה (VPN)", "owner": "Adi (Elta)", "start": "2026-02-20", "end": "2026-03-22", "startOffset": 46, "duration": 30, "deps": "6"}, {"id": "8", "phase": "1.3 Sync", "name": "סנכרון אבני דרך בין Amendment 1 לנספח התשלומים", "owner": "צוות יעוץ", "start": "2026-01-17", "end": "2026-01-24", "startOffset": 12, "duration": 7, "deps": "4"}, {"id": "9", "phase": "1.3 Org", "name": "עדכון תרשים מבנה ארגוני (Org Chart) - אינדיגו", "owner": "Indigo", "start": "2026-01-07", "end": "2026-01-12", "startOffset": 2, "duration": 5, "deps": "2"}, {"id": "10", "phase": "2. Design", "name": "CDR - תכנון הנדסי מפורט (Design Phase)", "owner": "Engineering", "start": "2026-01-05", "end": "2026-03-06", "startOffset": 0, "duration": 60, "deps": ""}, {"id": "11", "phase": "2.1 Core", "name": "תכנון LLD רשת וסגמנטציה (Dell Core)", "owner": "System Eng", "start": "2026-01-17", "end": "2026-02-01", "startOffset": 12, "duration": 15, "deps": "4"}, {"id": "12", "phase": "2.1 Core", "name": "תכנון חוקת Firewall ותורת אבטחה", "owner": "Security Eng", "start": "2026-02-01", "end": "2026-02-11", "startOffset": 27, "duration": 10, "deps": "11"}, {"id": "13", "phase": "2.2 Remote", "name": "תכנון פריסת 17 אתרי קצה (Remote Sites v3.0)", "owner": "System Eng", "start": "2026-02-01", "end": "2026-02-21", "startOffset": 27, "duration": 20, "deps": "11"}, {"id": "14", "phase": "2.2 Remote", "name": "תכנון ניטור OT פסיבי (Modbus/IEC60870)", "owner": "OT Expert", "start": "2026-02-21", "end": "2026-03-08", "startOffset": 47, "duration": 15, "deps": "13"}, {"id": "15", "phase": "2.3 DR/BU", "name": "תכנון פתרון DR (החלטה: חדר בקרה משני פיזי)", "owner": "צוות יעוץ/Adi", "start": "2026-02-01", "end": "2026-02-15", "startOffset": 27, "duration": 14, "deps": "11"}, {"id": "16", "phase": "2.3 DR/BU", "name": "תכנון מערך גיבוי (On-Prem vs Cloud)", "owner": "System Eng", "start": "2026-02-15", "end": "2026-02-22", "startOffset": 41, "duration": 7, "deps": "15"}, {"id": "17", "phase": "2.4 Elta", "name": "תכנון אינטגרציית CyConcerto & CyScan", "owner": "Elta Eng", "start": "2026-02-01", "end": "2026-02-16", "startOffset": 27, "duration": 15, "deps": "11"}, {"id": "18", "phase": "2.5 Approval", "name": "הגשת ספר CDR סופי לאישור הלקוח (MoE)", "owner": "צוות יעוץ", "start": "2026-02-16", "end": "2026-02-26", "startOffset": 42, "duration": 10, "deps": "17"}, {"id": "19", "phase": "3. Procurement", "name": "רכש, לוגיסטיקה ושילוח (BOM)", "owner": "Procurement", "start": "2026-01-05", "end": "2026-04-05", "startOffset": 0, "duration": 90, "deps": ""}, {"id": "20", "phase": "3.1 Hardware", "name": "הוצאת PO לחומרת Dell (Servers/Storage)", "owner": "צוות יעוץ", "start": "2026-02-26", "end": "2026-03-03", "startOffset": 52, "duration": 5, "deps": "18"}, {"id": "21", "phase": "3.1 Hardware", "name": "הוצאת PO לציוד Fortinet (Core/Edge)", "owner": "צוות יעוץ", "start": "2026-02-26", "end": "2026-03-03", "startOffset": 52, "duration": 5, "deps": "18"}, {"id": "22", "phase": "3.2 SW/Lic", "name": "רכישת רישיונות QRadar (36 Months)", "owner": "צוות יעוץ", "start": "2026-03-03", "end": "2026-03-08", "startOffset": 57, "duration": 5, "deps": "20"}, {"id": "23", "phase": "3.2 SW/Lic", "name": "רכישת רישיונות VMware vSphere & SRM", "owner": "צוות יעוץ", "start": "2026-03-03", "end": "2026-03-08", "startOffset": 57, "duration": 5, "deps": "20"}, {"id": "24", "phase": "3.2 SW/Lic", "name": "רכישת רישיונות Centerity (IT/OT)", "owner": "צוות יעוץ", "start": "2026-03-03", "end": "2026-03-08", "startOffset": 57, "duration": 5, "deps": "20"}, {"id": "25", "phase": "3.3 Logist", "name": "ביצוע Staging ובדיקות DOA במעבדה בארץ", "owner": "Indigo Eng", "start": "2026-03-03", "end": "2026-03-24", "startOffset": 57, "duration": 21, "deps": "21"}, {"id": "26", "phase": "3.3 Logist", "name": "עדכון תנאי שילוח ל-CIP/DAP (Air Freight)", "owner": "צוות יעוץ", "start": "2026-03-24", "end": "2026-03-27", "startOffset": 78, "duration": 3, "deps": "25"}, {"id": "27", "phase": "3.3 Logist", "name": "שילוח אוירי לאקרה ושחרור ממכס", "owner": "Logistics", "start": "2026-03-27", "end": "2026-04-10", "startOffset": 81, "duration": 14, "deps": "26"}, {"id": "28", "phase": "4. HR/Training", "name": "גיוס כוח אדם והדרכות (KT)", "owner": "HR / Indigo", "start": "2026-01-05", "end": "2026-02-19", "startOffset": 0, "duration": 45, "deps": ""}, {"id": "29", "phase": "4.1 Hiring", "name": "גיוס מהנדס מערכת מקומי (System Engineer)", "owner": "Indigo", "start": "2026-01-21", "end": "2026-02-20", "startOffset": 16, "duration": 30, "deps": "3"}, {"id": "30", "phase": "4.1 Hiring", "name": "גיוס צוות אנליסטים SOC (Tier 1-3)", "owner": "Indigo", "start": "2026-02-20", "end": "2026-03-22", "startOffset": 46, "duration": 30, "deps": "29"}, {"id": "31", "phase": "4.2 Training", "name": "קורס מנהלי מערכת (Infrastructure)", "owner": "Indigo Eng", "start": "2026-03-22", "end": "2026-03-27", "startOffset": 76, "duration": 5, "deps": "30"}, {"id": "32", "phase": "4.2 Training", "name": "הכשרת אנליסטים על מוצרי Elta/QRadar", "owner": "Elta/Indigo", "start": "2026-03-27", "end": "2026-04-06", "startOffset": 81, "duration": 10, "deps": "31"}, {"id": "33", "phase": "5. Surveys", "name": "סקרי אתר ל-17 גופים (Site Surveys)", "owner": "Survey Team", "start": "2026-01-05", "end": "2026-03-06", "startOffset": 0, "duration": 60, "deps": ""}, {"id": "34", "phase": "5.1 - 5.17", "name": "סקר אתר: VRA", "owner": "Survey Team", "start": "2026-02-26", "end": "2026-03-01", "startOffset": 52, "duration": 3, "deps": "18"}, {"id": "35", "phase": "5.1 - 5.17", "name": "סקר אתר: GRIDCo", "owner": "Survey Team", "start": "2026-02-26", "end": "2026-03-01", "startOffset": 52, "duration": 3, "deps": "18"}, {"id": "36", "phase": "5.1 - 5.17", "name": "סקר אתר: ECG", "owner": "Survey Team", "start": "2026-02-26", "end": "2026-03-01", "startOffset": 52, "duration": 3, "deps": "18"}, {"id": "37", "phase": "5.1 - 5.17", "name": "סקר אתר: NEDCo", "owner": "Survey Team", "start": "2026-02-26", "end": "2026-03-01", "startOffset": 52, "duration": 3, "deps": "18"}, {"id": "38", "phase": "5.1 - 5.17", "name": "סקר אתר: BPA", "owner": "Survey Team", "start": "2026-02-26", "end": "2026-03-01", "startOffset": 52, "duration": 3, "deps": "18"}, {"id": "39", "phase": "5.1 - 5.17", "name": "סקר אתר: GNPC", "owner": "Survey Team", "start": "2026-02-26", "end": "2026-03-01", "startOffset": 52, "duration": 3, "deps": "18"}, {"id": "40", "phase": "5.1 - 5.17", "name": "סקר אתר: GNGC", "owner": "Survey Team", "start": "2026-02-26", "end": "2026-03-01", "startOffset": 52, "duration": 3, "deps": "18"}, {"id": "41", "phase": "5.1 - 5.17", "name": "סקר אתר: BOST", "owner": "Survey Team", "start": "2026-02-26", "end": "2026-03-01", "startOffset": 52, "duration": 3, "deps": "18"}, {"id": "42", "phase": "5.1 - 5.17", "name": "סקר אתר: Energy Commission", "owner": "Survey Team", "start": "2026-02-26", "end": "2026-03-01", "startOffset": 52, "duration": 3, "deps": "18"}, {"id": "43", "phase": "5.1 - 5.17", "name": "סקר אתר: PURC", "owner": "Survey Team", "start": "2026-02-26", "end": "2026-03-01", "startOffset": 52, "duration": 3, "deps": "18"}, {"id": "44", "phase": "5.1 - 5.17", "name": "סקר אתר: MoE", "owner": "Survey Team", "start": "2026-02-26", "end": "2026-03-01", "startOffset": 52, "duration": 3, "deps": "18"}, {"id": "45", "phase": "5.1 - 5.17", "name": "סקר אתר: VRA-Generation", "owner": "Survey Team", "start": "2026-02-26", "end": "2026-03-01", "startOffset": 52, "duration": 3, "deps": "18"}, {"id": "46", "phase": "5.1 - 5.17", "name": "סקר אתר: Volta Aluminium", "owner": "Survey Team", "start": "2026-02-26", "end": "2026-03-01", "startOffset": 52, "duration": 3, "deps": "18"}, {"id": "47", "phase": "5.1 - 5.17", "name": "סקר אתר: Tema Oil Refinery", "owner": "Survey Team", "start": "2026-02-26", "end": "2026-03-01", "startOffset": 52, "duration": 3, "deps": "18"}, {"id": "48", "phase": "5.1 - 5.17", "name": "סקר אתר: Ghana Gas", "owner": "Survey Team", "start": "2026-02-26", "end": "2026-03-01", "startOffset": 52, "duration": 3, "deps": "18"}, {"id": "49", "phase": "5.1 - 5.17", "name": "סקר אתר: Takoradi Plant", "owner": "Survey Team", "start": "2026-02-26", "end": "2026-03-01", "startOffset": 52, "duration": 3, "deps": "18"}, {"id": "50", "phase": "5.1 - 5.17", "name": "סקר אתר: Karpowership", "owner": "Survey Team", "start": "2026-02-26", "end": "2026-03-01", "startOffset": 52, "duration": 3, "deps": "18"}, {"id": "51", "phase": "5.18", "name": "אישור דוחות SSR סופיים מול הארגונים", "owner": "צוות יעוץ", "start": "2026-03-01", "end": "2026-03-11", "startOffset": 55, "duration": 10, "deps": "50"}, {"id": "52", "phase": "6. Core Build", "name": "הקמת מרכז ה-CERT (Core DC)", "owner": "Indigo Eng", "start": "2026-01-05", "end": "2026-02-14", "startOffset": 0, "duration": 40, "deps": ""}, {"id": "53", "phase": "6.1 Physical", "name": "התקנת Racks, כבילה וחשמל", "owner": "Local Ops", "start": "2026-04-10", "end": "2026-04-17", "startOffset": 95, "duration": 7, "deps": "27"}, {"id": "54", "phase": "6.2 Compute", "name": "התקנת שרתי Dell R660 ו-vSAN", "owner": "Indigo Eng", "start": "2026-04-17", "end": "2026-04-27", "startOffset": 102, "duration": 10, "deps": "53"}, {"id": "55", "phase": "6.3 Security", "name": "התקנת Fortinet Core והגדרת VPN Gateway", "owner": "Security Eng", "start": "2026-04-27", "end": "2026-05-04", "startOffset": 112, "duration": 7, "deps": "54"}, {"id": "56", "phase": "6.4 Apps", "name": "פריסת IBM QRadar Console/EP", "owner": "Indigo Eng", "start": "2026-05-04", "end": "2026-05-14", "startOffset": 119, "duration": 10, "deps": "55"}, {"id": "57", "phase": "6.5 Apps", "name": "התקנת CyConcerto, CyScan, CyShare", "owner": "Elta Eng", "start": "2026-05-14", "end": "2026-05-24", "startOffset": 129, "duration": 10, "deps": "56"}, {"id": "58", "phase": "6.6 NOC", "name": "הקמת ה-SOC הפיזי (קיר וידאו/ריהוט)", "owner": "Local Ops", "start": "2026-04-17", "end": "2026-04-27", "startOffset": 102, "duration": 10, "deps": "53"}, {"id": "59", "phase": "7. Remote Sites", "name": "אינטגרציית 17 אתרי קצה", "owner": "Indigo Eng", "start": "2026-01-05", "end": "2026-03-06", "startOffset": 0, "duration": 60, "deps": ""}, {"id": "60", "phase": "7.1 - 7.17", "name": "התקנת ציוד (FortiGate 80F) באתר: VRA", "owner": "Indigo Eng", "start": "2026-04-10", "end": "2026-04-14", "startOffset": 95, "duration": 4, "deps": "51, 27"}, {"id": "61", "phase": "7.1 - 7.17", "name": "התקנת ציוד (FortiGate 80F) באתר: GRIDCo", "owner": "Indigo Eng", "start": "2026-04-10", "end": "2026-04-14", "startOffset": 95, "duration": 4, "deps": "51, 27"}, {"id": "62", "phase": "7.1 - 7.17", "name": "התקנת ציוד (FortiGate 80F) באתר: ECG", "owner": "Indigo Eng", "start": "2026-04-10", "end": "2026-04-14", "startOffset": 95, "duration": 4, "deps": "51, 27"}, {"id": "63", "phase": "7.1 - 7.17", "name": "התקנת ציוד (FortiGate 80F) באתר: NEDCo", "owner": "Indigo Eng", "start": "2026-04-10", "end": "2026-04-14", "startOffset": 95, "duration": 4, "deps": "51, 27"}, {"id": "64", "phase": "7.1 - 7.17", "name": "התקנת ציוד (FortiGate 80F) באתר: BPA", "owner": "Indigo Eng", "start": "2026-04-10", "end": "2026-04-14", "startOffset": 95, "duration": 4, "deps": "51, 27"}, {"id": "65", "phase": "7.1 - 7.17", "name": "התקנת ציוד (FortiGate 80F) באתר: GNPC", "owner": "Indigo Eng", "start": "2026-04-10", "end": "2026-04-14", "startOffset": 95, "duration": 4, "deps": "51, 27"}, {"id": "66", "phase": "7.1 - 7.17", "name": "התקנת ציוד (FortiGate 80F) באתר: GNGC", "owner": "Indigo Eng", "start": "2026-04-10", "end": "2026-04-14", "startOffset": 95, "duration": 4, "deps": "51, 27"}, {"id": "67", "phase": "7.1 - 7.17", "name": "התקנת ציוד (FortiGate 80F) באתר: BOST", "owner": "Indigo Eng", "start": "2026-04-10", "end": "2026-04-14", "startOffset": 95, "duration": 4, "deps": "51, 27"}, {"id": "68", "phase": "7.1 - 7.17", "name": "התקנת ציוד (FortiGate 80F) באתר: Energy Commission", "owner": "Indigo Eng", "start": "2026-04-10", "end": "2026-04-14", "startOffset": 95, "duration": 4, "deps": "51, 27"}, {"id": "69", "phase": "7.1 - 7.17", "name": "התקנת ציוד (FortiGate 80F) באתר: PURC", "owner": "Indigo Eng", "start": "2026-04-10", "end": "2026-04-14", "startOffset": 95, "duration": 4, "deps": "51, 27"}, {"id": "70", "phase": "7.1 - 7.17", "name": "התקנת ציוד (FortiGate 80F) באתר: MoE", "owner": "Indigo Eng", "start": "2026-04-10", "end": "2026-04-14", "startOffset": 95, "duration": 4, "deps": "51, 27"}, {"id": "71", "phase": "7.1 - 7.17", "name": "התקנת ציוד (FortiGate 80F) באתר: VRA-Generation", "owner": "Indigo Eng", "start": "2026-04-10", "end": "2026-04-14", "startOffset": 95, "duration": 4, "deps": "51, 27"}, {"id": "72", "phase": "7.1 - 7.17", "name": "התקנת ציוד (FortiGate 80F) באתר: Volta Aluminium", "owner": "Indigo Eng", "start": "2026-04-10", "end": "2026-04-14", "startOffset": 95, "duration": 4, "deps": "51, 27"}, {"id": "73", "phase": "7.1 - 7.17", "name": "התקנת ציוד (FortiGate 80F) באתר: Tema Oil Refinery", "owner": "Indigo Eng", "start": "2026-04-10", "end": "2026-04-14", "startOffset": 95, "duration": 4, "deps": "51, 27"}, {"id": "74", "phase": "7.1 - 7.17", "name": "התקנת ציוד (FortiGate 80F) באתר: Ghana Gas", "owner": "Indigo Eng", "start": "2026-04-10", "end": "2026-04-14", "startOffset": 95, "duration": 4, "deps": "51, 27"}, {"id": "75", "phase": "7.1 - 7.17", "name": "התקנת ציוד (FortiGate 80F) באתר: Takoradi Plant", "owner": "Indigo Eng", "start": "2026-04-10", "end": "2026-04-14", "startOffset": 95, "duration": 4, "deps": "51, 27"}, {"id": "76", "phase": "7.1 - 7.17", "name": "התקנת ציוד (FortiGate 80F) באתר: Karpowership", "owner": "Indigo Eng", "start": "2026-04-10", "end": "2026-04-14", "startOffset": 95, "duration": 4, "deps": "51, 27"}, {"id": "77", "phase": "7.18", "name": "הקמת VPN Tunnels ואימות תקשורת", "owner": "Security Eng", "start": "2026-04-14", "end": "2026-04-24", "startOffset": 99, "duration": 10, "deps": "76"}, {"id": "78", "phase": "7.19", "name": "התקנת OT Passive Taps באתרי הייצור", "owner": "OT Expert", "start": "2026-04-24", "end": "2026-05-09", "startOffset": 109, "duration": 15, "deps": "77"}, {"id": "79", "phase": "8. DR Site", "name": "הקמת אתר ה-DR (Disaster Recovery)", "owner": "System Eng", "start": "2026-01-05", "end": "2026-02-04", "startOffset": 0, "duration": 30, "deps": ""}, {"id": "80", "phase": "8.1 Build", "name": "התקנת חומרה באתר המשני", "owner": "Local Ops", "start": "2026-04-10", "end": "2026-04-17", "startOffset": 95, "duration": 7, "deps": "27"}, {"id": "81", "phase": "8.2 Rep", "name": "הגדרת Unity Async Replication", "owner": "Indigo Eng", "start": "2026-04-17", "end": "2026-04-24", "startOffset": 102, "duration": 7, "deps": "80"}, {"id": "82", "phase": "8.3 SRM", "name": "הגדרת VMware SRM ל-Failover אוטומטי", "owner": "Indigo Eng", "start": "2026-04-24", "end": "2026-05-01", "startOffset": 109, "duration": 7, "deps": "81"}, {"id": "83", "phase": "9. ATP Core", "name": "בדיקות קבלה - ליבה (ATP Group A/B)", "owner": "צוות יעוץ/Elta", "start": "2026-01-05", "end": "2026-02-04", "startOffset": 0, "duration": 30, "deps": ""}, {"id": "84", "phase": "9.1 Infra", "name": "בדיקת יתירות חשמל (Pull the Plug)", "owner": "System Eng", "start": "2026-04-27", "end": "2026-04-28", "startOffset": 112, "duration": 1, "deps": "54"}, {"id": "85", "phase": "9.1 Infra", "name": "בדיקת ביצועי Storage (IOMeter)", "owner": "System Eng", "start": "2026-04-27", "end": "2026-04-29", "startOffset": 112, "duration": 2, "deps": "54"}, {"id": "86", "phase": "9.1 Infra", "name": "בדיקת יתירות שרתים (vMotion/HA)", "owner": "System Eng", "start": "2026-04-27", "end": "2026-04-29", "startOffset": 112, "duration": 2, "deps": "54"}, {"id": "87", "phase": "9.2 SIEM", "name": "בדיקת קליטת לוגים (EPS Validation)", "owner": "Indigo Eng", "start": "2026-05-14", "end": "2026-05-17", "startOffset": 129, "duration": 3, "deps": "56"}, {"id": "88", "phase": "9.2 Apps", "name": "בדיקת פונקציונליות CyConcerto (SOAR)", "owner": "Elta Eng", "start": "2026-05-24", "end": "2026-05-27", "startOffset": 139, "duration": 3, "deps": "57"}, {"id": "89", "phase": "9.2 Apps", "name": "בדיקת סריקת פגיעות CyScan", "owner": "Elta Eng", "start": "2026-05-24", "end": "2026-05-26", "startOffset": 139, "duration": 2, "deps": "57"}, {"id": "90", "phase": "9.2 Apps", "name": "בדיקת שיתוף מידע CyShare", "owner": "Elta Eng", "start": "2026-05-24", "end": "2026-05-26", "startOffset": 139, "duration": 2, "deps": "57"}, {"id": "91", "phase": "10. ATP Scenarios", "name": "בדיקות תרחישים מבצעיים (ConOps)", "owner": "Elta/Indigo", "start": "2026-01-05", "end": "2026-01-25", "startOffset": 0, "duration": 20, "deps": ""}, {"id": "92", "phase": "10.1 Case 1", "name": "תרחיש: מודיעין איומים והפצה לארגונים", "owner": "Elta Eng", "start": "2026-05-27", "end": "2026-05-30", "startOffset": 142, "duration": 3, "deps": "88"}, {"id": "93", "phase": "10.2 Case 2", "name": "תרחיש: מתקפה מגזרית רוחבית", "owner": "Elta Eng", "start": "2026-05-30", "end": "2026-06-04", "startOffset": 145, "duration": 5, "deps": "92"}, {"id": "94", "phase": "10.3 Case 3", "name": "תרחיש: סיוע פורנזי (Forensic Lab Test)", "owner": "Indigo Eng", "start": "2026-06-04", "end": "2026-06-07", "startOffset": 150, "duration": 3, "deps": "93"}, {"id": "95", "phase": "10.4 Case 4", "name": "תרחיש: חסימת EDR באתר מרוחק", "owner": "Security Eng", "start": "2026-06-07", "end": "2026-06-10", "startOffset": 153, "duration": 3, "deps": "94"}, {"id": "96", "phase": "11. ATP Remote", "name": "בדיקות קבלה - 17 אתרים (Group C)", "owner": "Indigo Eng", "start": "2026-01-05", "end": "2026-02-04", "startOffset": 0, "duration": 30, "deps": ""}, {"id": "97", "phase": "11.1 - 11.17", "name": "בדיקת ATP באתר: VRA (VPN וזמינות)", "owner": "Indigo Eng", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "98", "phase": "11.1 - 11.17", "name": "בדיקת ATP באתר: GRIDCo (VPN וזמינות)", "owner": "Indigo Eng", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "99", "phase": "11.1 - 11.17", "name": "בדיקת ATP באתר: ECG (VPN וזמינות)", "owner": "Indigo Eng", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "100", "phase": "ATP Stage A", "name": "בדיקות קבלה תשתית פיזית (Facility)", "owner": "Indigo", "start": "2026-04-14", "end": "2026-04-16", "startOffset": 99, "duration": 2, "deps": "60"}, {"id": "101", "phase": "A.1", "name": "בדיקת ויזואלית של ארונות תקשורת (Inventory)", "owner": "Indigo", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "61.0"}, {"id": "102", "phase": "A.2", "name": "בדיקת כבילה וסימון (Labeling)", "owner": "Indigo", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "61.0"}, {"id": "103", "phase": "A.3", "name": "בדיקת יתירות הזנות חשמל (Dual PDU)", "owner": "Indigo", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "101.0"}, {"id": "104", "phase": "A.4", "name": "בדיקת יתירות הזנות חשמל (Dual PDU)", "owner": "Indigo", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "103.0"}, {"id": "105", "phase": "A.5", "name": "בדיקת מערכת כיבוי אש ומיזוג בחדר השרתים", "owner": "Local", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "101.0"}, {"id": "106", "phase": "11.1 - 11.17", "name": "בדיקת ATP באתר: PURC (VPN וזמינות)", "owner": "Indigo Eng", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "107", "phase": "11.1 - 11.17", "name": "בדיקת ATP באתר: MoE (VPN וזמינות)", "owner": "Indigo Eng", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "108", "phase": "11.1 - 11.17", "name": "בדיקת ATP באתר: VRA-Generation (VPN וזמינות)", "owner": "Indigo Eng", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "109", "phase": "11.1 - 11.17", "name": "בדיקת ATP באתר: Volta Aluminium (VPN וזמינות)", "owner": "Indigo Eng", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "110", "phase": "ATP Stage B", "name": "בדיקות קבלה חומרה ושרתים (Hardware)", "owner": "System Eng", "start": "2026-04-14", "end": "2026-04-16", "startOffset": 99, "duration": 2, "deps": "61"}, {"id": "111", "phase": "B.1", "name": "בדיקת iDRAC Connectivity לכל שרתי Dell", "owner": "System", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "62.0"}, {"id": "112", "phase": "B.2", "name": "בדיקת Storage Health (Unity Array)", "owner": "System", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "62.0"}, {"id": "113", "phase": "B.3", "name": "בדיקת Disk Failure (הוצאת דיסק פיזי)", "owner": "System", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "112.0"}, {"id": "114", "phase": "B.4", "name": "בדיקת יתירות מתגי Core (Switch Stack)", "owner": "System", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "55.0"}, {"id": "115", "phase": "B.5", "name": "בדיקת Network Latency בתוך ה-DC", "owner": "System", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "114.0"}, {"id": "116", "phase": "12. ATP DR", "name": "בדיקות קבלה - DR (Group D)", "owner": "Indigo Eng", "start": "2026-01-05", "end": "2026-01-20", "startOffset": 0, "duration": 15, "deps": ""}, {"id": "117", "phase": "12.1 Sync", "name": "בדיקת עמידה ב-RPO (Sync Validation)", "owner": "System Eng", "start": "2026-05-01", "end": "2026-05-03", "startOffset": 116, "duration": 2, "deps": "82"}, {"id": "118", "phase": "12.2 Failover", "name": "הרצת SRM Failover מלא לאתר DR", "owner": "System Eng", "start": "2026-05-03", "end": "2026-05-08", "startOffset": 118, "duration": 5, "deps": "117"}, {"id": "119", "phase": "12.3 Failback", "name": "בדיקת חזרה לאתר ראשי (Failback)", "owner": "System Eng", "start": "2026-05-08", "end": "2026-05-11", "startOffset": 123, "duration": 3, "deps": "118"}, {"id": "120", "phase": "ATP Stage C", "name": "בדיקות וירטואליזציה (VMware)", "owner": "System Eng", "start": "2026-04-14", "end": "2026-04-16", "startOffset": 99, "duration": 2, "deps": "63"}, {"id": "121", "phase": "C.1", "name": "בדיקת יתירות שרתים (HA) - כיבוי שרת פיזי", "owner": "System", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "63.0"}, {"id": "122", "phase": "C.2", "name": "בדיקת vMotion (העברת VM ללא ניתוק)", "owner": "System", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "121.0"}, {"id": "123", "phase": "C.3", "name": "בדיקת עומסי CPU/RAM על ה-Cluster", "owner": "System", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "122.0"}, {"id": "124", "phase": "C.4", "name": "בדיקת יתירות vSAN (Disk Group Failure)", "owner": "System", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "122.0"}, {"id": "130", "phase": "ATP Stage D", "name": "בדיקות מערכות ליבה (CERT Tools)", "owner": "Elta/Indigo", "start": "2026-04-14", "end": "2026-04-16", "startOffset": 99, "duration": 2, "deps": "65"}, {"id": "131", "phase": "D.1", "name": "IBM QRadar: בדיקת Log Sources מ-17 גופים", "owner": "Indigo", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "77.0"}, {"id": "132", "phase": "D.2", "name": "IBM QRadar: בדיקת Flow Sources (Network Traffic)", "owner": "Indigo", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "131.0"}, {"id": "133", "phase": "D.3", "name": "CyConcerto: בדיקת אינטגרציה מול SIEM", "owner": "Elta", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "57.0"}, {"id": "134", "phase": "D.4", "name": "CyConcerto: בדיקת Dashboard וממשק משתמש", "owner": "Elta", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "133.0"}, {"id": "135", "phase": "D.5", "name": "CyScan: הרצת סריקה על רשת ה-DC", "owner": "Elta", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "57.0"}, {"id": "136", "phase": "D.6", "name": "CyShare: העלאת והורדת קובץ מודיעין", "owner": "Elta", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "57.0"}, {"id": "137", "phase": "D.7", "name": "Centerity: בדיקת התראות NMS (IT/OT)", "owner": "Indigo", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "60.0"}, {"id": "140", "phase": "ATP Stage E", "name": "בדיקות תרחישים (Operational/ConOps)", "owner": "Elta", "start": "2026-01-05", "end": "2026-01-07", "startOffset": 0, "duration": 2, "deps": "133.0"}, {"id": "141", "phase": "E.1", "name": "תרחיש: זיהוי Brute Force ונעילת משתמש", "owner": "Elta", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "131.0"}, {"id": "142", "phase": "E.2", "name": "תרחיש: זיהוי Ransomware ב-Endpoint", "owner": "Elta", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "95.0"}, {"id": "143", "phase": "E.3", "name": "תרחיש: מתקפת DDOS מגזרית (Multi-Site)", "owner": "Elta", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "141.0"}, {"id": "144", "phase": "E.4", "name": "תרחיש: הדמיית דליפת גז (OT Alert)", "owner": "Elta", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "114.0"}, {"id": "145", "phase": "E.5", "name": "תרחיש: ניהול אירוע ב-CyConcerto מקצה לקצה", "owner": "Elta", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "143.0"}, {"id": "150", "phase": "ATP Stage F", "name": "בדיקות שרידות ואתר משני (DR)", "owner": "צוות יעוץ/Eng", "start": "2026-05-01", "end": "2026-05-03", "startOffset": 116, "duration": 2, "deps": "82"}, {"id": "151", "phase": "F.1", "name": "בדיקת Replication Health (Unity)", "owner": "System", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "81.0"}, {"id": "152", "phase": "F.2", "name": "בדיקת SRM Recovery Plan (Simulation)", "owner": "System", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "82.0"}, {"id": "153", "phase": "F.3", "name": "בדיקת Failover מלאה (אתר ראשי מושבת)", "owner": "System", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "152.0"}, {"id": "154", "phase": "F.4", "name": "בדיקת זמינות אפליקציות באתר ה-DR", "owner": "System", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "153.0"}, {"id": "155", "phase": "F.5", "name": "בדיקת Failback (חזרה לאקרה)", "owner": "System", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "154.0"}, {"id": "160", "phase": "ATP Stage G", "name": "בדיקות 17 אתרי קצה (Remote Sites)", "owner": "Indigo", "start": "2026-01-05", "end": "2026-01-07", "startOffset": 0, "duration": 2, "deps": "77.0"}, {"id": "161", "phase": "G.1", "name": "בדיקת Firewall & VPN – VRA", "owner": "Indigo", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "162", "phase": "G.2", "name": "בדיקת Firewall & VPN – GRIDCo", "owner": "Indigo", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "163", "phase": "G.3", "name": "בדיקת Firewall & VPN – ECG", "owner": "Indigo", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "164", "phase": "G.4", "name": "בדיקת Firewall & VPN – NEDCo", "owner": "Indigo", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "165", "phase": "G.5", "name": "בדיקת Firewall & VPN – BPA", "owner": "Indigo", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "166", "phase": "G.6", "name": "בדיקת Firewall & VPN – GNPC", "owner": "Indigo", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "167", "phase": "G.7", "name": "בדיקת Firewall & VPN – GNGC", "owner": "Indigo", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "168", "phase": "G.8", "name": "בדיקת Firewall & VPN – BOST", "owner": "Indigo", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "169", "phase": "G.9", "name": "בדיקת Firewall & VPN – Energy Commission", "owner": "Indigo", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "170", "phase": "G.10", "name": "בדיקת Firewall & VPN – PURC", "owner": "Indigo", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "171", "phase": "G.11", "name": "בדיקת Firewall & VPN – MoE", "owner": "Indigo", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "172", "phase": "G.12", "name": "בדיקת Firewall & VPN – VRA-Generation", "owner": "Indigo", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "173", "phase": "G.13", "name": "בדיקת Firewall & VPN – Volta Aluminium", "owner": "Indigo", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "174", "phase": "G.14", "name": "בדיקת Firewall & VPN – Tema Oil Refinery", "owner": "Indigo", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "175", "phase": "G.15", "name": "בדיקת Firewall & VPN – Ghana Gas", "owner": "Indigo", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "176", "phase": "G.16", "name": "בדיקת Firewall & VPN – Takoradi Plant", "owner": "Indigo", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "177", "phase": "G.17", "name": "בדיקת Firewall & VPN – Karpowership", "owner": "Indigo", "start": "2026-04-24", "end": "2026-04-25", "startOffset": 109, "duration": 1, "deps": "77"}, {"id": "178", "phase": "G.18", "name": "בדיקת Local Backup (Veeam) בכל אתר", "owner": "System", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "161.0"}, {"id": "179", "phase": "G.19", "name": "בדיקת ניטור OT Tap וזיהוי פרוטוקול", "owner": "OT Exp", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "78.0"}, {"id": "180", "phase": "Closure", "name": "סיכום, תיעוד ומסירה", "owner": "צוות יעוץ", "start": "2026-01-05", "end": "2026-01-07", "startOffset": 0, "duration": 2, "deps": "155.0"}, {"id": "181", "phase": "13.1", "name": "איסוף חתימות ATP מכל 17 הגופים", "owner": "צוות יעוץ", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "177.0"}, {"id": "182", "phase": "13.2", "name": "הכנת דוח ATP סופי (Final Test Report)", "owner": "צוות יעוץ", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "181.0"}, {"id": "183", "phase": "13.3", "name": "מסירת ספר \"As-Built\" מעודכן", "owner": "צוות יעוץ", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "182.0"}, {"id": "184", "phase": "13.4", "name": "העברת אחריות לצוות O&M (תמיכה)", "owner": "צוות יעוץ", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "183.0"}, {"id": "185", "phase": "13.5", "name": "חתימה על תעודת קבלה סופית (PAC)", "owner": "צוות יעוץ", "start": "2026-01-05", "end": "2026-01-06", "startOffset": 0, "duration": 1, "deps": "184.0"}];
let ALL = BASE.map(t => ({...t}));
const STORE_KEY = "gantt_tasks_v5_edits";

// ===== Category coloring =====
function categoryOf(t){
  const p = (t.phase||"").trim();
  // Examples: "1.1 Admin", "2. Design", "ATP Stage A", "A.1", "Closure", "G.12"
  if (!p) return "Other";
  if (p.toLowerCase().startsWith("atp")) return "ATP";
  if (p.toLowerCase() === "closure") return "Closure";
  // Take first token like "1", "2", "13.4", "A.1", "G.12"
  const first = p.split(/\s+/)[0];
  // If numeric like "1.3" -> major "1"
  const m = first.match(/^([0-9]+)(?:\.|$)/);
  if (m) return "Phase " + m[1];
  // If letter group like "A.1" / "G.12" -> major letter
  const m2 = first.match(/^([A-Z])\./i);
  if (m2) return "Group " + m2[1].toUpperCase();
  return first;
}
function colorForCategory(cat){
  // Stable palette
  const palette = [
    "#2563eb", "#16a34a", "#f59e0b", "#dc2626", "#9333ea",
    "#0891b2", "#7c3aed", "#0ea5e9", "#22c55e", "#ea580c",
    "#be123c", "#0f766e", "#4f46e5", "#a16207", "#1d4ed8"
  ];
  // simple hash
  let h=0;
  for (let i=0;i<cat.length;i++) h = (h*31 + cat.charCodeAt(i)) >>> 0;
  return palette[h % palette.length];
}
function depsLabel(t){
  const d = (t.deps||"").trim();
  if (!d) return "";
  // keep only digits, dots, commas; show up to 30 chars
  return d.length > 30 ? (d.slice(0,30) + "…") : d;
}

function isMilestone(t){
  // Milestone is a point-in-time marker (diamond). We treat as milestone only when duration is very small.
  const dur = Number(t.duration ?? 1);
  const n = ((t.notes||"") + " " + (t.name||"")).trim();
  const flagged = /(milestone|אבן\s*דרך)/i.test(n);
  return (dur === 0) || (flagged && dur <= 2);
}
function parseDepIds(depStr){
  const d = String(depStr||"").trim();
  if (!d) return [];
  return d.split(/[,\s]+/).map(x=>x.trim()).filter(Boolean).map(x=>{
    // keep only numeric id if present
    const m = x.match(/^(\d+)$/);
    return m ? m[1] : null;
  }).filter(Boolean);
}
function autoScheduleAll(){
  // Kahn topological scheduling: startOffset = max(dep.startOffset + dep.duration)
  const byId = new Map(ALL.map(t=>[String(t.id), t]));
  const indeg = new Map();
  const succ = new Map();
  ALL.forEach(t=>{
    const tid = String(t.id);
    const deps = parseDepIds(t.deps);
    indeg.set(tid, deps.length);
    deps.forEach(d=>{
      if(!succ.has(d)) succ.set(d, []);
      succ.get(d).push(tid);
    });
  });
  const q = [];
  indeg.forEach((v,k)=>{ if(v===0) q.push(k); });
  const order = [];
  while(q.length){
    const x = q.shift();
    order.push(x);
    (succ.get(x)||[]).forEach(y=>{
      indeg.set(y, indeg.get(y)-1);
      if(indeg.get(y)===0) q.push(y);
    });
  }
  // If cycle, fall back to ID sort
  const ids = (order.length===ALL.length) ? order : ALL.map(t=>String(t.id)).sort((a,b)=>Number(a)-Number(b));
  ids.forEach(id=>{
    const t = byId.get(id);
    if(!t) return;
    const deps = parseDepIds(t.deps);
    let best = 0;
    deps.forEach(d=>{
      const dt = byId.get(d);
      if(!dt) return;
      const dur = Math.max(0, Number(dt.duration||0));
      best = Math.max(best, Number(dt.startOffset||0) + dur);
    });
    // Keep milestones at best too (duration can be 0)
    t.startOffset = best;
    calcDatesFromOffsets(t);
  });
  // Persist everything
  const edits = {};
  ALL.forEach(t=>{
    edits[t.id] = { startOffset: t.startOffset, duration: t.duration, start: t.start, end: t.end };
  });
  saveEdits(edits);
  render();
}



function loadEdits() {
  try {
    const raw = localStorage.getItem(STORE_KEY);
    if (!raw) return null;
    return JSON.parse(raw);
  } catch(e) { return null; }
}
function saveEdits(edits) {
  try { localStorage.setItem(STORE_KEY, JSON.stringify(edits)); } catch(e) {}
}

function daysBetween(a,b) { return Math.round((b-a)/MS_DAY); }
function clamp(n, min, max) { return Math.max(min, Math.min(max, n)); }
function fmt(d) {
  const yyyy=d.getFullYear();
  const mm=String(d.getMonth()+1).padStart(2,'0');
  const dd=String(d.getDate()).padStart(2,'0');
  return `${yyyy}-${mm}-${dd}`;
}
function calcDatesFromOffsets(t) {
  const s = new Date(MIN_START.getTime() + (t.startOffset||0)*MS_DAY);
  const dur = Math.max(0, Number(t.duration ?? 1));
  const e = new Date(s.getTime() + dur*MS_DAY);
  t.start = fmt(s);
  t.end = fmt(e);
}
(function applyLocal() {
  const edits = loadEdits();
  if (!edits) return;
  ALL = ALL.map(t => {
    const e = edits[t.id];
    if (!e) return t;
    return {...t, startOffset: e.startOffset, duration: e.duration, start: e.start, end: e.end};
  });
})();
ALL.forEach(t => calcDatesFromOffsets(t));

// Owner filter
const ownerSel = document.getElementById('ownerFilter');
Array.from(new Set(ALL.map(t => (t.owner||'').trim()).filter(Boolean))).sort().forEach(o => {
  const opt = document.createElement('option');
  opt.value = o;
  opt.textContent = o;
  ownerSel.appendChild(opt);
});

function pxPerDayForZoom() {
  const z = document.getElementById('zoom').value;
  return (z==='day') ? 18 : (z==='week' ? 7 : 2.5);
}
function buildTicks(pxPerDay) {
  const tl = document.getElementById('timeline');
  tl.innerHTML = '';
  const ticks = document.createElement('div');
  ticks.className='ticks';
  const totalDays = daysBetween(MIN_START, MAX_END);
  const zoom = document.getElementById('zoom').value;
  const step = zoom==='day' ? 1 : (zoom==='week' ? 7 : 30);

  for (let i=0;i<=totalDays;i++) {
    const d = new Date(MIN_START.getTime() + i*MS_DAY);
    const tick = document.createElement('div');
    tick.className='tick';
    tick.style.width = pxPerDay+'px';
    tick.textContent = (i % step === 0) ? fmt(d) : '';
    ticks.appendChild(tick);
  }
  ticks.style.width = ((totalDays+1)*pxPerDay)+'px';
  tl.appendChild(ticks);
}

function persistOne(t) {
  const edits = loadEdits() || {};
  edits[t.id] = { startOffset: t.startOffset, duration: t.duration, start: t.start, end: t.end };
  saveEdits(edits);
}
function findTask(id) { return ALL.find(x => String(x.id)===String(id)); }

function attachDrag(barEl, pxPerDay, isMs=false) {
  let mode = "move";
  let startX = 0;
  let origOffset = 0;
  let origDuration = 0;

  function onPointerDown(e) {
    const handle = e.target?.dataset?.handle;
    if (isMs) { mode = 'move'; }
    else { mode = handle === 'left' ? 'resizeL' : (handle === 'right' ? 'resizeR' : 'move'); }
    barEl.setPointerCapture(e.pointerId);
    barEl.classList.add('dragging');
    startX = e.clientX;
    const t = findTask(barEl.dataset.id);
    origOffset = t.startOffset;
    origDuration = t.duration;
    e.preventDefault();
    e.stopPropagation();
  }

  function onPointerMove(e) {
    if (!barEl.classList.contains('dragging')) return;
    const dx = e.clientX - startX;
    const deltaDays = Math.round(dx / pxPerDay); // snap
    const t = findTask(barEl.dataset.id);
    if (!t) return;

    if (mode === 'move') {
      t.startOffset = clamp(origOffset + deltaDays, 0, 100000);
    } else if (mode === 'resizeR') {
      t.duration = clamp(origDuration + deltaDays, 1, 100000);
    } else if (mode === 'resizeL') {
      const newOffset = origOffset + deltaDays;
      const newDur = origDuration - deltaDays;
      if (newDur >= 1) {
        t.startOffset = clamp(newOffset, 0, 100000);
        t.duration = newDur;
      }
    }

    calcDatesFromOffsets(t);
    barEl.style.left = (t.startOffset*pxPerDay)+'px';
    if (!isMs) {
      barEl.style.width = (Math.max(1,t.duration)*pxPerDay)+'px';
      barEl.title = `${t.name} (Start: ${t.start}, End: ${t.end})`;
    } else {
      barEl.title = `${t.name} (Milestone) ${t.start}`;
    }
  }

  function onPointerUp(e) {
    if (!barEl.classList.contains('dragging')) return;
    barEl.classList.remove('dragging');
    const t = findTask(barEl.dataset.id);
    if (t) persistOne(t);
    try { barEl.releasePointerCapture(e.pointerId); } catch(_e) {}
  }

  barEl.addEventListener('pointerdown', onPointerDown);
  barEl.addEventListener('pointermove', onPointerMove);
  barEl.addEventListener('pointerup', onPointerUp);
  barEl.addEventListener('pointercancel', onPointerUp);
}

function render() {
  const q = (document.getElementById('q').value||'').toLowerCase().trim();
  const ownerVal = (document.getElementById('ownerFilter').value||'').toLowerCase();
  const pxPerDay = pxPerDayForZoom();

  const baseList = !q ? ALL : ALL.filter(t =>
    (t.name||'').toLowerCase().includes(q) ||
    (t.owner||'').toLowerCase().includes(q) ||
    (t.phase||'').toLowerCase().includes(q) ||
    (t.id||'').toLowerCase().includes(q)
  );
  const list = !ownerVal ? baseList : baseList.filter(t => (t.owner||'').toLowerCase()===ownerVal);

  // Legend (categories in current view)
  const legend = document.getElementById('legend');
  if (legend){
    const cats = Array.from(new Set(list.map(t => categoryOf(t)))).sort();
    legend.innerHTML = '';
    cats.forEach(cat => {
      const item = document.createElement('div');
      item.className = 'lg-item';
      const sw = document.createElement('div');
      sw.className = 'sw';
      sw.style.background = colorForCategory(cat);
      const tx = document.createElement('div');
      tx.textContent = cat;
      item.appendChild(sw);
      item.appendChild(tx);
      legend.appendChild(item);
    });
  }


  
  const left = document.getElementById('left');
  left.innerHTML='';
  const h = document.createElement('div');
  h.className='row group-header';
  h.innerHTML = `<div class="meta">ID</div><div class="title">שלב / משימה</div><div class="meta">Owner</div>`;
  left.appendChild(h);

  // Group by Phase
  PHASE_GROUPS.length = 0;

  Object.keys(groups).sort().forEach(phase=>{
    const gh = document.createElement('div');
    gh.className='row group-header clickable';
    gh.innerHTML = `<div class="meta"></div><div class="title">▸ ${phase}</div><div class="meta">${groups[phase].length}</div>`;
    left.appendChild(gh);

    let open = false;
    PHASE_GROUPS.push({toggle:()=>gh.onclick(), rows, header:gh});
    gh.onclick = ()=>{
      open = !open;
      gh.querySelector('.title').textContent = (open?'▾ ':'▸ ') + phase;
      rows.forEach(r=>r.style.display = open?'flex':'none');
    };

    const rows=[];
    groups[phase].forEach(t=>{
      const r = document.createElement('div');
      r.className='row clickable';
      r.style.display='none';
      r.innerHTML = `<div class="meta">#${t.id}</div><div class="title">${t.name}</div><div class="meta">${t.owner||''}</div>`;
      r.onclick = ()=>openPanel(t);
      rows.push(r);
      left.appendChild(r);
    });
  });


  buildTicks(pxPerDay);

  const bars = document.getElementById('bars');
  bars.innerHTML='';
  // Dependency overlay (SVG)
  const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
  svg.classList.add('dep-layer');
  svg.setAttribute('aria-hidden','true');
  const defs = document.createElementNS('http://www.w3.org/2000/svg','defs');
  const marker = document.createElementNS('http://www.w3.org/2000/svg','marker');
  marker.setAttribute('id','arrow');
  marker.setAttribute('markerWidth','10');
  marker.setAttribute('markerHeight','10');
  marker.setAttribute('refX','8');
  marker.setAttribute('refY','3');
  marker.setAttribute('orient','auto');
  const ap = document.createElementNS('http://www.w3.org/2000/svg','path');
  ap.setAttribute('d','M0,0 L8,3 L0,6 Z');
  ap.setAttribute('fill','#64748b');
  marker.appendChild(ap);
  defs.appendChild(marker);
  svg.appendChild(defs);
  bars.appendChild(svg);

  const totalDays = daysBetween(MIN_START, MAX_END);
  const width = ((totalDays+1)*pxPerDay);

  list.forEach(t => {
    const row = document.createElement('div');
    row.className='bar-row';
    row.style.width = width+'px';

    const milestoneFlag = isMilestone(t);
    if (milestoneFlag) {
      // Milestone diamond
      const ms = document.createElement('div');
      ms.className='milestone';
      ms.dataset.id = t.id;
      ms.style.left = (t.startOffset*pxPerDay)+'px';
      ms.title = `${t.name} (Milestone) ${t.start}`;
      const lbl = document.createElement('div');
      lbl.className='mlabel';
      lbl.textContent = `#${t.id} · ${t.name}`;
      ms.appendChild(lbl);
      ms.addEventListener('click', ()=>openPanel(t));
      attachDrag(ms, pxPerDay, true);
      row.appendChild(ms);
      bars.appendChild(row);
      return;
    }

    const bar = document.createElement('div');
    bar.className='bar';
    bar.dataset.id = t.id;
    bar.style.left = (t.startOffset*pxPerDay)+'px';
    bar.style.width = (Math.max(1,t.duration)*pxPerDay)+'px';

    const cat = categoryOf(t);
    const col = colorForCategory(cat);
    bar.style.background = col;

    bar.title = `${t.name} (Start: ${t.start}, End: ${t.end})`;

    const lbl = document.createElement('div');
    lbl.className = 'label';
    lbl.textContent = `#${t.id} · ${t.name}`;
    const dep = depsLabel(t);
    const depEl = document.createElement('div');
    depEl.className = 'deps';
    depEl.textContent = dep ? `Deps: ${dep}` : '';
    bar.appendChild(lbl);
    bar.appendChild(depEl);

const hL = document.createElement('div');
    hL.className='handle left';
    hL.dataset.handle='left';
    const hR = document.createElement('div');
    hR.className='handle right';
    hR.dataset.handle='right';
    bar.appendChild(hL);
    bar.appendChild(hR);

    bar.addEventListener('dblclick', () => {
      openPanel(t);
      return;
      //\n${t.name}\nPhase: ${t.phase}\nOwner: ${t.owner}\nStart: ${t.start}\nEnd: ${t.end}\nDuration: ${t.duration}d\nDeps: ${t.deps||'-'}`);
    });

    attachDrag(bar, pxPerDay);
    row.appendChild(bar);
    bars.appendChild(row);
  });

  // Draw dependency lines (only among visible tasks)
  const rowsCount = list.length;
  const svgHeight = rowsCount * 34;
  svg.setAttribute('width', width);
  svg.setAttribute('height', svgHeight);
  svg.setAttribute('viewBox', `0 0 ${width} ${svgHeight}`);
  // clear previous lines (keep defs)
  Array.from(svg.querySelectorAll('path.dep')).forEach(p => p.remove());
  const centerY = (i) => (i*34 + 17);
  const barEndX = (tt) => ((tt.startOffset + Math.max(0,Number(tt.duration||0))) * pxPerDay);
  const barStartX = (tt) => (tt.startOffset * pxPerDay);
  const visibleById = new Map(list.map((tt, i) => [String(tt.id), {t:tt, i}]));
  list.forEach((tt, i) => {
    const deps = String(tt.deps||'').split(/[,\s]+/).map(x=>x.trim()).filter(Boolean);
    deps.forEach(did => {
      if (!visibleById.has(did)) return;
      const from = visibleById.get(did);
      const x1 = barEndX(from.t);
      const y1 = centerY(from.i);
      const x2 = barStartX(tt);
      const y2 = centerY(i);
      const midX = (x1 + x2) / 2;
      const p = document.createElementNS('http://www.w3.org/2000/svg','path');
      p.classList.add('dep');
      p.setAttribute('d', `M ${x1} ${y1} L ${midX} ${y1} L ${midX} ${y2} L ${x2} ${y2}`);
      p.setAttribute('fill','none');
      p.setAttribute('stroke','#64748b');
      p.setAttribute('stroke-width','1.2');
      p.setAttribute('marker-end','url(#arrow)');
      svg.appendChild(p);
    });
  });

}

function exportCSV() {
  // Export ALL tasks as UTF-8 with BOM so Excel shows Hebrew correctly
  const header = ["מזהה","קטגוריה/שלב","שם משימה","אחראי","תאריך התחלה","תאריך סיום","משך (ימים)","תלויות","הערות"];
  const rows = [header.join(",")];
  const esc = (v) => {
    const s = String(v ?? "");
    if (s.includes('"') || s.includes(",") || s.includes("\n") || s.includes("\r")) return '"' + s.replace(/"/g,'""') + '"';
    return s;
  };
  ALL.forEach(t => {
    rows.push([
      esc(t.id),
      esc(t.phase),
      esc(t.name),
      esc(t.owner),
      esc(t.start),
      esc(t.end),
      esc(t.duration),
      esc(t.deps||""),
      esc(t.notes||"")
    ].join(","));
  });
  const bom = "\uFEFF";
  const csvText = bom + rows.join("\r\n");
  const blob = new Blob([csvText], {type:"text/csv;charset=utf-8"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "גאנט_ייצוא.csv";
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(()=>URL.revokeObjectURL(url), 5000);
}

function resetAll() {
  localStorage.removeItem(STORE_KEY);
  ALL = BASE.map(t => ({...t}));
  ALL.forEach(t => calcDatesFromOffsets(t));
  ownerSel.innerHTML = '<option value="">כל ה-Owners</option>';
  Array.from(new Set(ALL.map(t => (t.owner||'').trim()).filter(Boolean))).sort().forEach(o => {
    const opt = document.createElement('option');
    opt.value = o;
    opt.textContent = o;
    ownerSel.appendChild(opt);
  });
  document.getElementById('q').value='';
  document.getElementById('ownerFilter').value='';
  document.getElementById('zoom').value='week';
  render();
}

document.getElementById('q').addEventListener('input', render);
document.getElementById('ownerFilter').addEventListener('change', render);
document.getElementById('zoom').addEventListener('change', render);
document.getElementById('autoSchedule').addEventListener('click', autoScheduleAll);
document.getElementById('exportCsv').addEventListener('click', exportCSV);
document.getElementById('reset').addEventListener('click', resetAll);

render();

function openPanel(t){
  const p = document.getElementById('sidePanel');
  const b = document.getElementById('panelBody');
  b.innerHTML = `
    <div><strong>ID:</strong> ${t.id}</div>
    <div><strong>שלב:</strong> ${t.phase}</div>
    <div><strong>משימה:</strong> ${t.name}</div>
    <div><strong>אחראי:</strong> ${t.owner}</div>
    <div><strong>התחלה:</strong> ${t.start}</div>
    <div><strong>סיום:</strong> ${t.end}</div>
    <div><strong>משך:</strong> ${t.duration} ימים</div>
    <div><strong>תלויות:</strong> ${t.deps||'-'}</div>
    <div><strong>הערות:</strong><br>${t.notes||''}</div>
  `;
  p.style.right='0';
}
document.getElementById('closePanel').onclick = ()=>{
  document.getElementById('sidePanel').style.right='-420px';
};

</script>
</body>
</html>
